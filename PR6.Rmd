---
title: "Практическая работа 6"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(message = FALSE)
```

Получим и выведем набор данных mtcars.

```{r}
cars<-data.frame(mtcars)
print(cars)
summary(cars)
```

Описание переменных:

- [, 1] mpg Miles/(US) gallon Пробег, мили/(американский) галлон
- [, 2] cyl Number of cylinders Количество цилиндров
- [, 3] disp Displacement (cu.in.) Смещение
- [, 4] hp Gross horsepower Число лошадиных сил
- [, 5] drat Rear axle ratio Передаточное отношение заднего моста
- [, 6] wt Weight (1000 lbs) Вес
- [, 7] qsec 1/4 mile time Время 1/4 мили
- [, 8] vs Engine (0 = V-shaped, 1 = straight) Двигатель (0 = V-образный, 1 = Прямой)
- [, 9] am Transmission (0 = automatic, 1 = manual) Передача (0 = автоматическая, 1 = ручная)
- [,10] gear Number of forward gears Количество передних передач
- [,11] carb Number of carburetors Количество карбюраторов

Построим матричную диаграмму зависимости перменных друг от друга.
При этом ниже диагонали покажем корреляцию переменных, а выше диагонали - графики зависимости переменных.

```{r}
pairs(
  cars, 
  main = "Matrix Diagram", 
  panel = function(x, y) {
    points(x, y)
    abline(lm(y~x), col = 'red')
  }, 
  lower.panel = function(x, y) {
    par(usr = c(0, 1, 0, 1))
    text(0.5, 0.5, paste0("", round(cor(x, y), digits=2)), cex = 1)
  }
)
```

### Анализ главных компонент (PCA)

Теперь выполним анализ главных компонент с помощью функции princomp.
При этом исключим из анализа все переменные кроме количественных.

```{r}
cars <- cars[,1:7]
pc.cars<-princomp(cars, scores = TRUE)
pc.cars
```

```{r}
summary(pc.cars)
```

Наибольшая доля дисперсии объясняется первой компонентой (0.9271198).

Выведем матрицу нагрузок с помощью функции loadings.

```{r}
loadings(pc.cars)
```

Покажем также результаты анализа на диаграмме.

```{r}
plot(pc.cars)
```

Согласно критерию Кайзера-Харриса (Kaiser-Harris), в анализ достаточно включить компоненты с дисперсией больше 1.

### Вывод

Для характеристики приведенногонабора данных достаточно включить первые 4 компоненты, которые вместе объясняют 0.9999724859 совокупной дисперсии.

## Факторный анализ

Сначала выполним факторный анализ с числом факторов 1.

```{r}
fc.cars <- factanal(cars, factors = 1, start=NULL, scores = "Bartlett", STATISTIC)
fc.cars
```

В полученном результате можно увидеть тест значимости фактора (p-value = 7.1e-07), означающий хорошую подгонку факторной модели, однако доля объясненной дисперсии достаточно невелика - 0.697.

В полученном одномерном пространстве построим гистограмму для анализа структуры данных.

```{r}
hist(fc.cars$scores)
```

Выполним факторный анализ для 2 главных факторов

```{r}
fc.cars <- factanal(cars, factors=2, start=NULL, scores = "Bartlett" ,rotation = "varimax", STATISTIC)
fc.cars
```

Как видно, два фактора достаточны и объясняют большую долю вариации (0.859). 

Отобразим все объекты выборки для анализа структуры в полученном двумерном пространстве.

```{r}
plot(fc.cars$scores)
```

Выполним теперь факторный анализ для 2 главных факторов с вращением типа promax.

```{r}
fc.cars <- factanal(cars, factors=2, start=NULL, scores = "Bartlett", rotation = "promax", STATISTIC)
fc.cars
```

Помимо уникальностей и факторных нагрузок выведена корреляционная матрица: корреляция двух факторов (0.514) достаточно небольшая. Доля объясненной дисперсии стала незначительно ниже (0.853).

Выведем также даиграмму объектов в пространстве двух факторов.

```{r}
plot(fc.cars$scores)
```
